{"id":1667,"date":"2014-02-05T14:30:09","date_gmt":"2014-02-05T21:30:09","guid":{"rendered":"http:\/\/xiehang.com\/blog\/?p=1667"},"modified":"2014-03-20T07:00:43","modified_gmt":"2014-03-20T14:00:43","slug":"mount-qemu-vm-image","status":"publish","type":"post","link":"https:\/\/xiehang.com\/blog\/2014\/02\/05\/mount-qemu-vm-image\/","title":{"rendered":"Mount qemu VM image"},"content":{"rendered":"<p>I accidentally changed some configuration of a VM and it refused to start after reboot, I know I can simply revert what I changed to make it works again so to avoid recovery process, and I found <a href=\"http:\/\/alexeytorkhov.blogspot.com\/2009\/09\/mounting-raw-and-qcow2-vm-disk-images.html\">this great article<\/a> which described exactly what I want. I&#8217;m going to repeat the steps here as I also need to write steps to unmount. Note that you need to have kpartx installed.<!--more--><\/p>\n<p>Most VMs are in volume group, so here are steps to mount the VM image:<br \/>\n[shell]<br \/>\nsudo losetup \/dev\/loop0 \/home\/VM\/vm1\/disk.img<br \/>\nsudo kpartx -a \/dev\/loop0<br \/>\nsudo vgscan<br \/>\nsudo vgchange -ay<br \/>\nsudo vgscan<br \/>\n# figure out name of the volume group by comparing output of two vgscan<br \/>\nsudo mount \/dev\/vg_name\/lv_root \/mnt<br \/>\n# now you can go to \/mnt\/etc to edit those configurations, then<br \/>\nsudo umount \/mnt<br \/>\nsudo vgchange -an vg_name<br \/>\nsudo kpartx -d \/dev\/loop0<br \/>\nsudo losetup -d \/dev\/loop0<br \/>\n[\/shell]<\/p>\n","protected":false},"excerpt":{"rendered":"<p>I accidentally changed some configuration of a VM and it refused to start after reboot, I know I can simply revert what I changed to make it works again so to avoid recovery process, and I found this great article which described exactly what I want. I&#8217;m going to repeat the steps here as I <a href='https:\/\/xiehang.com\/blog\/2014\/02\/05\/mount-qemu-vm-image\/' class='excerpt-more'>[&#8230;]<\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[1],"tags":[83,477,478,131,479],"_links":{"self":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/1667"}],"collection":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/comments?post=1667"}],"version-history":[{"count":3,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/1667\/revisions"}],"predecessor-version":[{"id":1681,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/1667\/revisions\/1681"}],"wp:attachment":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/media?parent=1667"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/categories?post=1667"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/tags?post=1667"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}