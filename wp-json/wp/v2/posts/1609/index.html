{"id":1609,"date":"2014-01-03T14:37:46","date_gmt":"2014-01-03T21:37:46","guid":{"rendered":"http:\/\/xiehang.com\/blog\/?p=1609"},"modified":"2014-01-28T11:03:14","modified_gmt":"2014-01-28T18:03:14","slug":"enable-console-on-vms","status":"publish","type":"post","link":"https:\/\/xiehang.com\/blog\/2014\/01\/03\/enable-console-on-vms\/","title":{"rendered":"Enable console on VMs"},"content":{"rendered":"<p>Finally I decide to turn on console on all my VMs so that I don&#8217;t have to rely on VNC for remote access whenever network is having problem &#8211; I&#8217;m trying to join corp network now and there are lots of network glitches during last week and I believe there will still be some in the coming week.<\/p>\n<p>Actually it&#8217;s not that complicated, on CentOS (5 or 6) machines, add following line to \/etc\/inittab (do a dmesg | grep tty to make sure it is ttyS0 for you, but I believe they are all the same for kvm based VMs):<!--more--><br \/>\n<code># for console<br \/>\nT0:2345:respawn:\/sbin\/agetty -h -L ttyS0 38400 vt100<br \/>\n<\/code><\/p>\n<p>then in \/boot\/grub\/grub.conf:<\/p>\n<ol>\n<li>Comment out this line:<br \/>\n<code>splashimage=(hd0,0)\/grub\/splash.xpm.gz<\/code><\/li>\n<li>Add following lines after &#8220;hiddenmenu&#8221;, again make sure you are using the right tty device:<br \/>\n<code>serial --unit=0 --speed=38400 --word=8 --parity=no --stop=1<br \/>\nterminal --timeout=10 serial console<br \/>\n<\/code><\/li>\n<li>Append these to each line start with &#8220;kernel \/vmlinux&#8230;&#8221;:<br \/>\n<code>console=tty0 console=ttyS0,38400n8<\/code><\/li>\n<\/ol>\n<p>Reboot the machine, and attach to to console by &#8220;virsh console &#8220;, then you will get console for both book progress and normal login.<\/p>\n<p>On Ubuntu 10.04 or 12.04 (these are two versions I&#8217;m currently using), create \/etc\/init\/ttyS0.conf:<br \/>\n<code># ttyS0 - getty<br \/>\n#<br \/>\n# This service maintains a getty on ttyS0 from the point the system is<br \/>\n# started until it is shut down again.<\/p>\n<p>start on stopped rc or RUNLEVEL=[12345]<br \/>\nstop on runlevel [!12345]<\/p>\n<p>respawn<br \/>\nexec \/sbin\/getty -L 115200 ttyS0 vt102<\/code><\/p>\n<p>Then edit \/etc\/default\/grub, change or add following lines:<br \/>\n<code>GRUB_CMDLINE_LINUX=\"console=tty0 console=ttyS0,115200n8\"<br \/>\nGRUB_TERMINAL=serial<br \/>\nGRUB_SERIAL_COMMAND=\"serial --speed=115200 --unit=0 --word=8 --parity=no --stop=1\"<br \/>\n<\/code><\/p>\n<p>then &#8220;update-grub&#8221; to make it into real \/boot\/grub\/grub.cfg (you can verify those console lines after running the command), then reboot, everything should be there.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Finally I decide to turn on console on all my VMs so that I don&#8217;t have to rely on VNC for remote access whenever network is having problem &#8211; I&#8217;m trying to join corp network now and there are lots of network glitches during last week and I believe there will still be some in <a href='https:\/\/xiehang.com\/blog\/2014\/01\/03\/enable-console-on-vms\/' class='excerpt-more'>[&#8230;]<\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[1],"tags":[465,131],"_links":{"self":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/1609"}],"collection":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/comments?post=1609"}],"version-history":[{"count":2,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/1609\/revisions"}],"predecessor-version":[{"id":1641,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/1609\/revisions\/1641"}],"wp:attachment":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/media?parent=1609"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/categories?post=1609"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/tags?post=1609"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}