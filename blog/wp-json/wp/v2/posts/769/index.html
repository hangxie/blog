{"id":769,"date":"2009-11-25T00:46:49","date_gmt":"2009-11-25T07:46:49","guid":{"rendered":"http:\/\/xiehang.com\/blog\/?p=769"},"modified":"2009-11-30T00:07:27","modified_gmt":"2009-11-30T07:07:27","slug":"lvs","status":"publish","type":"post","link":"https:\/\/xiehang.com\/blog\/2009\/11\/25\/lvs\/","title":{"rendered":"LVS"},"content":{"rendered":"<p>Playing with LVS &#8211; so that I don&#8217;t have to connect to individual Cassandra server.<\/p>\n<p>What I planned for LVS:<\/p>\n<ul>\n<li>192.168.1.99 will be VIP<\/li>\n<li>f5 (192.168.1.205) will be LVS director &#8230; you are right, its name is f5 \ud83d\ude09<\/li>\n<li>f1 (192.168.1.101) to f4 (192.168.1.104) will be real server<\/li>\n<li>will do DR mode (I think it is called single-B on most L4 switches &#8230;)<\/li>\n<\/ul>\n<p>The configuration is actually pretty simple, as long as you get it right, on LVS director (f5):<\/p>\n<ul>\n<li>Configure VIP to eth0:0 as an alias, netmask should be 255.255.255.255, broadcast is VIP itself<\/li>\n<li>Add following rules with ipvsadm (yea &#8230; you need to install this package)<br \/>\n-A -t 192.168.1.99:9160 -s wlc<br \/>\n-a -t 192.168.1.99:9160 -r 192.168.1.101:9160 -g -w 1<br \/>\n-a -t 192.168.1.99:9160 -r 192.168.1.102:9160 -g -w 1<br \/>\n-a -t 192.168.1.99:9160 -r 192.168.1.103:9160 -g -w 1<br \/>\n-a -t 192.168.1.99:9160 -r 192.168.1.104:9160 -g -w 1<\/li>\n<li>Start LVS (after restart network to make sure VIP is effective) by &#8220;ipvsadm &#8211;start-daemon master&#8221;<\/li>\n<li>If you want to stop LVS you can do &#8220;ipvsadm &#8211;stop-daemon master&#8221;<\/li>\n<\/ul>\n<p>Now let&#8217;s turn to real servers &#8211; all real servers (f1~f4) are doing the same:<\/p>\n<ul>\n<li>Add these lines to \/etc\/sysctl.conf and then do a &#8220;sysctl -p&#8221;<br \/>\nnet.ipv4.conf.dummy0.arp_ignore = 1<br \/>\nnet.ipv4.conf.dummy0.arp_announce = 2<br \/>\nnet.ipv4.conf.all.arp_ignore = 1<br \/>\nnet.ipv4.conf.all.arp_announce = 2<\/li>\n<li>Configure VIP to dummy0 as an alias, netmask should be 255.255.255.255, broadcast is VIP itself<\/li>\n<li>Change ThriftAddress in storage-conf.xml for Cassandra, to 0.0.0.0 so that Thrift serves on all interfaces<\/li>\n<li>Remember to restart Cassandra so to make new configuration takes effect<\/li>\n<\/ul>\n<p>Now, launch your favorite client, connecting to 192.168.1.99:9160, you should get everything as if connect to individual server.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Playing with LVS &#8211; so that I don&#8217;t have to connect to individual Cassandra server. What I planned for LVS: 192.168.1.99 will be VIP f5 (192.168.1.205) will be LVS director &#8230; you are right, its name is f5 \ud83d\ude09 f1 (192.168.1.101) to f4 (192.168.1.104) will be real server will do DR mode (I think it <a href='https:\/\/xiehang.com\/blog\/2009\/11\/25\/lvs\/' class='excerpt-more'>[&#8230;]<\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[1],"tags":[13,135,133],"_links":{"self":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/769"}],"collection":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/comments?post=769"}],"version-history":[{"count":6,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/769\/revisions"}],"predecessor-version":[{"id":772,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/769\/revisions\/772"}],"wp:attachment":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/media?parent=769"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/categories?post=769"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/tags?post=769"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}