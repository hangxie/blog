{"id":1676,"date":"2014-03-12T13:42:44","date_gmt":"2014-03-12T20:42:44","guid":{"rendered":"http:\/\/xiehang.com\/blog\/?p=1676"},"modified":"2014-03-20T06:59:51","modified_gmt":"2014-03-20T13:59:51","slug":"unattended-ubuntu-vm-installation-with-preseed","status":"publish","type":"post","link":"https:\/\/xiehang.com\/blog\/2014\/03\/12\/unattended-ubuntu-vm-installation-with-preseed\/","title":{"rendered":"Unattended Ubuntu VM installation with preseed"},"content":{"rendered":"<p><a href=\"https:\/\/xiehang.com\/blog\/2014\/01\/27\/virtualization-glusterfs-and-automation\/\">This article<\/a> discussed how to install CentOS VM automatically with <a href=\"http:\/\/en.wikipedia.org\/wiki\/Kickstart_(Linux)\">kickstart<\/a>. I tried to do similar thing for Ubuntu as well but failed so many times. It seems kickstart works with RedHat families pretty well which makes perfect sense, while Ubuntu does not like that way too much.<!--more--><\/p>\n<p>So I turned to <a href=\"http:\/\/en.wikipedia.org\/wiki\/Preseed\">preseed<\/a>, which was from Debian but works for its derivatives as well. After dig around here comes the preseed file:<br \/>\n[raw]<br \/>\n## Options to set on the command line<br \/>\nd-i debian-installer\/locale string en_US<br \/>\nd-i console-setup\/ask_detect boolean false<br \/>\nd-i console-setup\/layoutcode string us<\/p>\n<p>d-i netcfg\/choose_interface select eth0<\/p>\n<p>d-i base-installer\/kernel\/override-image string linux-server<br \/>\nd-i clock-setup\/utc-auto boolean true<br \/>\nd-i clock-setup\/utc boolean true<br \/>\nd-i time\/zone string US\/Pacific<br \/>\nd-i clock-setup\/ntp boolean true<\/p>\n<p>d-i mirror\/country string US<br \/>\nd-i mirror\/http\/proxy string<br \/>\nd-i mirror\/http\/mirror select mirror.facebook.net<br \/>\nd-i pkgsel\/install-language-support boolean false<br \/>\nd-i pkgsel\/update-policy select none<br \/>\nd-i tasksel\/first select OpenSSH server<\/p>\n<p>d-i partman-auto\/disk string \/dev\/vda<br \/>\nd-i partman-auto\/method string regular<br \/>\nd-i partman-auto\/choose_recipe select atomic<br \/>\nd-i partman\/default_filesystem string ext4<br \/>\nd-i partman\/confirm_write_new_label boolean true<br \/>\nd-i partman\/choose_partition select finish<br \/>\nd-i partman\/confirm boolean true<br \/>\nd-i partman\/confirm_nooverwrite boolean true<\/p>\n<p>d-i passwd\/make-user boolean false<br \/>\nd-i passwd\/root-password-crypted password i-wont-tell-you-for-sure<br \/>\nd-i passwd\/root-login boolean true<br \/>\nd-i user-setup\/encrypt-home boolean false<\/p>\n<p>d-i grub-installer\/only_debian boolean true<br \/>\nd-i grub-installer\/with_other_os boolean true<br \/>\nd-i finish-install\/reboot_in_progress note<br \/>\n[\/raw]<\/p>\n<p>and launch the installation by:<br \/>\n[shell]<br \/>\nsudo virt-install &#8211;name ubuntu-test \\<br \/>\n  &#8211;ram 1024 &#8211;vcpus 1 \\<br \/>\n  &#8211;disk path=\/tmp\/test.img,size=20 \\<br \/>\n  &#8211;bridge=br2 \\<br \/>\n  &#8211;os-variant rhel6 &#8211;accelerate \\<br \/>\n  &#8211;location http:\/\/mirror.facebook.net\/ubuntu\/dists\/trusty\/main\/installer-amd64 \\<br \/>\n  &#8211;graphics none \\<br \/>\n  -x &#8221;<br \/>\n     preseed\/url=http:\/\/192.168.0.11\/preseed.cfg<br \/>\n     console=ttyS0<br \/>\n     locale=en_US<br \/>\n     console-keymaps-at\/keymap=us<br \/>\n     console-setup\/ask_detect=false<br \/>\n     console-setup\/layoutcode=us<br \/>\n     keyboard-configuration\/layout=USA<br \/>\n     keyboard-configuration\/variant=USA<br \/>\n     hostname=some-special-name<br \/>\n     domain=your.domain<br \/>\n     &#8221;<br \/>\n[\/shell]<\/p>\n<p>After the unattended installation finished, you will have:<\/p>\n<ul>\n<li>Ubuntu 14.04 (trusty) from facebook.net mirror<\/li>\n<li>whole disk partitioned in to \/ and swap<\/li>\n<li>root is the only user to allowed to login with encrypted password<\/li>\n<li>host name set to some-special-name if DHCP does not provide valid one<\/li>\n<\/ul>\n<p>To make things better, you can configure your DHCP server to have MAC address map to some good name and IP address, then add &#8220;&#8211;mac=52:54:00:xx:xx:xx&#8221; to virt-install command line, the host name and domain from the DHCP server will have higher priority.<\/p>\n<p>Play with it, you will like it. \ud83d\ude1b<\/p>\n","protected":false},"excerpt":{"rendered":"<p>This article discussed how to install CentOS VM automatically with kickstart. I tried to do similar thing for Ubuntu as well but failed so many times. It seems kickstart works with RedHat families pretty well which makes perfect sense, while Ubuntu does not like that way too much.<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[1],"tags":[67,484,59,483],"_links":{"self":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/1676"}],"collection":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/comments?post=1676"}],"version-history":[{"count":2,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/1676\/revisions"}],"predecessor-version":[{"id":1679,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/posts\/1676\/revisions\/1679"}],"wp:attachment":[{"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/media?parent=1676"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/categories?post=1676"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/xiehang.com\/blog\/wp-json\/wp\/v2\/tags?post=1676"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}